#!/bin/bash

if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi
packagemanager="NONE"
updateflaak=""
yesflaak=""
distupgradeflaak=""
upgradeflaak=""
autoremoveflaak=""

logfile="/var/log/vo-utilities.log"
echo "[Log Start]" > $logfile


lsb_release -i | grep -q "Ubuntu" &> $logfile 
if [ $? -eq 0 ]; then
   echo "distro is Ubuntu"
   packagemanager="apt"
   updateflaak="update"
   yesflaak="-y"
   distupgradeflaak="dist-upgrade"
   upgradeflaak="upgrade"
   autoremoveflaak="autoremove"
fi
lsb_release -i | grep -q "Arch" &> $logfile 
if [ $? -eq 0 ]; then
   echo "distro is Arch"
    packagemanager="pacman" 
    updateflaak="-Syyu"
    yesflaak="--noconfirm"
    distupgradeflaak=$updateflaak
    upgradeflaak=$updateflaak
    autoremoveflaak="-Qtdq " # Lists packages but doesn't remove them
fi

lsb_release -i | grep -q "Manjaro" &> $logfile 
if [ $? -eq 0 ]; then
   echo "distro is Manjaro"
    packagemanager="pacman" 
    updateflaak="-Syyu"
    yesflaak="--noconfirm"
    distupgradeflaak=$updateflaak
    upgradeflaak=$updateflaak
    autoremoveflaak="-Qtdq " # Lists packages but doesn't remove them
fi

if [ $packagemanager == "NONE" ]; then
   echo "distro is not supported"
   exit 1
fi

echo "starting update"
$packagemanager $updateflaak $yesflaak &> $logfile 
if [ $? -eq 0 ]; then
    echo "succeeded to search updated packages"
else
    echo "failed to search updated packages"
    exit 1
fi
$packagemanager $distupgradeflaak $yesflaak &> $logfile 
if [ $? -eq 0 ]; then
    echo "succeeded updating distro"
else
    echo "failed updating distro"
    exit 1
fi
$packagemanager $upgradeflaak $yesflaak &> $logfile 
if [ $? -eq 0 ]; then
    echo "succeeded updating packages"
else
    echo "failed updating packages"
    exit 1
fi
$packagemanager $autoremoveflaak $yesflaak  &> $logfile 
if [ $? -eq 0 ]; then
    echo "succeeded removing old files"
else
    echo "failed removing old files"
    exit 1
fi
echo "done updating system"
